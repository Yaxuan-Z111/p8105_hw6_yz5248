p8105_hw6_yz5248
================
yz5248
2025-11-15

# Problem 1

``` r
homicides_df = read_csv("homicide-data.csv")
```

    ## Rows: 52179 Columns: 12
    ## ── Column specification ────────────────────────────────────────────────────────
    ## Delimiter: ","
    ## chr (9): uid, victim_last, victim_first, victim_race, victim_age, victim_sex...
    ## dbl (3): reported_date, lat, lon
    ## 
    ## ℹ Use `spec()` to retrieve the full column specification for this data.
    ## ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.

## cleaning the data

``` r
clean_df =
  homicides_df |>
  mutate(
    city_state = str_c(city, ", ", state),
    solved = if_else(
      disposition == "Closed by arrest", 1, 0
    ),
    victim_age = as.numeric(victim_age)
  ) |>
  filter(!city_state %in% c(
    "Dallas, TX", "Phoenix, AZ", "Kansas City, MO", "Tulsa, AL"
  )) |>
  filter(victim_race %in% c("Black", "White")) |>
  filter(victim_sex %in% c("Male", "Female")) |>
  mutate(
    victim_sex = as.factor(victim_sex)
  )|>
  drop_na(victim_age, victim_sex, victim_race)
```

    ## Warning: There was 1 warning in `mutate()`.
    ## ℹ In argument: `victim_age = as.numeric(victim_age)`.
    ## Caused by warning:
    ## ! NAs introduced by coercion

## fitting GLM function

``` r
baltimore_df =
  clean_df |>
  filter(city_state == "Baltimore, MD")

baltimore_fit =
  glm(
    solved ~ victim_age + victim_sex + victim_race,
    data = baltimore_df,
    family = binomial()
  )

baltimore_results =
  baltimore_fit |>
  broom::tidy(conf.int = TRUE, exponentiate = TRUE)

baltimore_results
```

    ## # A tibble: 4 × 7
    ##   term             estimate std.error statistic  p.value conf.low conf.high
    ##   <chr>               <dbl>     <dbl>     <dbl>    <dbl>    <dbl>     <dbl>
    ## 1 (Intercept)         1.36    0.171        1.81 7.04e- 2    0.976     1.91 
    ## 2 victim_age          0.993   0.00332     -2.02 4.30e- 2    0.987     1.00 
    ## 3 victim_sexMale      0.426   0.138       -6.18 6.26e-10    0.324     0.558
    ## 4 victim_raceWhite    2.32    0.175        4.82 1.45e- 6    1.65      3.28

``` r
baltimore_OR_male =
  baltimore_results |>
  filter(term == "victim_sexMale") |>
  select(term, estimate, conf.low, conf.high)

baltimore_OR_male
```

    ## # A tibble: 1 × 4
    ##   term           estimate conf.low conf.high
    ##   <chr>             <dbl>    <dbl>     <dbl>
    ## 1 victim_sexMale    0.426    0.324     0.558

## running for whole dataset

``` r
nested_df =
  clean_df |>
  group_by(city_state) |>
  nest()

results_df =
  nested_df |>
  mutate(
    fit = map(data, ~ glm(
      solved ~ victim_age + victim_sex + victim_race,
      data = .x,
      family = binomial()
    )),
    
    tidy_fit = map(fit, ~ tidy(
      .x,
      conf.int = TRUE,
      exponentiate = TRUE
    ))
  ) |>
  unnest(tidy_fit) |>
  filter(term == "victim_sexMale") |>
  select(
    city_state, estimate, conf.low, conf.high
  )
results_df
```

    ## # A tibble: 47 × 4
    ## # Groups:   city_state [47]
    ##    city_state      estimate conf.low conf.high
    ##    <chr>              <dbl>    <dbl>     <dbl>
    ##  1 Albuquerque, NM    1.77     0.825     3.76 
    ##  2 Atlanta, GA        1.00     0.680     1.46 
    ##  3 Baltimore, MD      0.426    0.324     0.558
    ##  4 Baton Rouge, LA    0.381    0.204     0.684
    ##  5 Birmingham, AL     0.870    0.571     1.31 
    ##  6 Boston, MA         0.667    0.351     1.26 
    ##  7 Buffalo, NY        0.521    0.288     0.936
    ##  8 Charlotte, NC      0.884    0.551     1.39 
    ##  9 Chicago, IL        0.410    0.336     0.501
    ## 10 Cincinnati, OH     0.400    0.231     0.667
    ## # ℹ 37 more rows

## plotting the result

``` r
results_plot =
  results_df |>
  arrange(estimate) |>   
  mutate(city_state = factor(city_state, levels = city_state)) |>
  ggplot(aes(x = city_state, y = estimate)) +
  geom_point(size = 2) +
  geom_errorbar(aes(ymin = conf.low, ymax = conf.high), width = 0.2) +
  coord_flip() +
  theme_minimal(base_size = 10)

results_plot
```

![](p8105_hw6_yz5248_files/figure-gfm/unnamed-chunk-6-1.png)<!-- --> The
plot shows substantial variation across cities in the adjusted odds
ratio for solving homicides involving male victims compared with female
victims. In most cities, the estimated ORs are close to 1, and many
confidence intervals include 1, suggesting little evidence of a strong
gender difference in clearance rates after adjusting for age and race.
However, several cities show ORs below 1, indicating lower clearance
rates for male victims relative to female victims, while a few cities
show ORs above 1. The wide confidence intervals seen in some
cities—particularly those with smaller numbers of homicide
cases—indicate substantial uncertainty in the estimated effects.
Overall, the association between victim sex and homicide resolution
varies by city, with no consistent pattern across locations.

# Problem 2

``` r
library(p8105.datasets)
data("weather_df")
```

## generate the function

``` r
bootstrap_est = function(df) {
  
  fit = lm(tmax ~ tmin + prcp, data = df)
  
  r2 = glance(fit)$r.squared
  
  coef_info = tidy(fit)
  beta1 = coef_info$estimate[coef_info$term == "tmin"]
  beta2 = coef_info$estimate[coef_info$term == "prcp"]
  
  tibble(
    r2 = r2,
    beta_ratio = beta1 / beta2
  )
}
```

## create a bootstrap framework

``` r
set.seed(100)  

bootstrap_results =
  tibble(i = 1:5000) |>
  mutate(
    boot_sample = map(i, ~ sample_n(weather_df, size = nrow(weather_df), replace = TRUE)),
    boot_est = map(boot_sample, bootstrap_est)
  ) |>
  select(-boot_sample) |>
  unnest(boot_est)
bootstrap_results
```

    ## # A tibble: 5,000 × 3
    ##        i    r2 beta_ratio
    ##    <int> <dbl>      <dbl>
    ##  1     1 0.945      -201.
    ##  2     2 0.938      -140.
    ##  3     3 0.939      -254.
    ##  4     4 0.945      -188.
    ##  5     5 0.939      -151.
    ##  6     6 0.943      -147.
    ##  7     7 0.943      -162.
    ##  8     8 0.936      -248.
    ##  9     9 0.943      -136.
    ## 10    10 0.947      -187.
    ## # ℹ 4,990 more rows

## plotting the R^2 distribution

``` r
dist_r2_plot =
  bootstrap_results |>
  ggplot(aes(x = r2)) +
  geom_density(fill = "lightblue", alpha = 0.5) +
  theme_minimal()
dist_r2_plot
```

![](p8105_hw6_yz5248_files/figure-gfm/unnamed-chunk-10-1.png)<!-- -->
The bootstrap distribution of $r^2$ is approximately symmetric and
concentrated around a value near 0.94. This indicates that the linear
model explains a consistently large proportion of the variability in
‘tmax’ across bootstrap samples. The distribution is fairly narrow,
suggesting that $r^2$ is estimated with relatively low uncertainty and
is stable across repeated resampling of the data.

## plotting the beta_ratio distribution

``` r
dist_ratio_plot =
  bootstrap_results |>
  ggplot(aes(x = beta_ratio)) +
  geom_density(fill = "lightgreen", alpha = 0.5) +
  theme_minimal()
dist_ratio_plot
```

![](p8105_hw6_yz5248_files/figure-gfm/unnamed-chunk-11-1.png)<!-- -->
The bootstrap distribution of the coefficient ratio $β₁ / β₂$ is much
more variable and strongly skewed. The distribution spreads widely, with
values ranging from roughly –500 to –100 and a long left tail. This
reflects substantial instability in the ratio, largely because $β₂$ is
small and close to 0 in many samples, making the ratio highly sensitive
to small changes in $β₂$.

## R^2 95% Confidence Interval

``` r
CI_R2 =
  bootstrap_results$r2 |>
  quantile(probs = c(0.025, 0.975))
CI_R2
```

    ##      2.5%     97.5% 
    ## 0.9343259 0.9466045

## Beta_ratio 95% Confidence Interval

``` r
CI_ratio =
  bootstrap_results$beta_ratio |>
  quantile(probs = c(0.025, 0.975))
CI_ratio
```

    ##      2.5%     97.5% 
    ## -280.5287 -125.6147
